<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexus Trade IA - Lucro Di√°rio</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      referrerpolicy="no-referrer"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              nexus: {
                green: '#00DFA5',
                dark: '#05070A',
                card: '#0B0F12',
                cyan: '#00E5FF'
              }
            },
            animation: {
              'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'glow': 'glow 2s ease-in-out infinite alternate',
            },
            keyframes: {
              glow: {
                '0%': { boxShadow: '0 0 10px rgba(0, 223, 165, 0.30)' },
                '100%': { boxShadow: '0 0 30px rgba(0, 223, 165, 0.60)' },
              }
            }
          }
        }
      }
    </script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
      body {
        font-family: 'Inter', sans-serif;
        background-color: #05070A;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="./index.css">
</head>
  <body>
    <div id="root"></div>
    <script>
      (function () {
        function getCookie(name) {
          const value = '; ' + document.cookie;
          const parts = value.split('; ' + name + '=');
          if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function setFbpCookie() {
          if (!getCookie('_fbp')) {
            const fbp =
              'fb.1.' + Date.now() + '.' + Math.floor(Math.random() * 1e10);
            document.cookie = `_fbp=${fbp}; path=/; domain=${location.hostname}; expires=${new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toUTCString()}`;
            console.log('‚úÖ _fbp criado manualmente:', fbp);
          } else {
            console.log('‚Ñπ _fbp j√° existe:', getCookie('_fbp'));
          }
        }

        setFbpCookie();
      })();
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        console.log(
          'Adicionando par√¢metros UTM e FBCLID aos bot√µes de redirecionamento...'
        );
        const params = new URLSearchParams(window.location.search);
        const fbclid = params.get('fbclid');
        const utm_content = params.get('utm_content');
        const utm_source = params.get('utm_source') || null;
        const utm_medium = params.get('utm_medium') || null;
        const utm_campaign = params.get('utm_campaign') || null;
        const utm_term = params.get('utm_term') || null;

        function getCookie(name) {
          const value = '; ' + document.cookie;
          const parts = value.split('; ' + name + '=');
          if (parts.length === 2) return parts.pop().split(';').shift();
        }

        const fbp = getCookie('_fbp');

        const botoes = document.querySelectorAll("a[href*='/redirect']");
        botoes.forEach((botao) => {
          const url = new URL(botao.href);
          if (fbclid) url.searchParams.set('fbclid', fbclid);
          if (utm_content) url.searchParams.set('utm_content', utm_content);
          if (utm_medium) url.searchParams.set('utm_medium', utm_medium);
          if (utm_campaign) url.searchParams.set('utm_campaign', utm_campaign);
          if (utm_source) url.searchParams.set('utm_source', utm_source);
          if (utm_term) url.searchParams.set('utm_term', utm_term);
          if (fbp) url.searchParams.set('fbp', fbp);
          botao.href = url.toString();
        });
      });
    </script>

    <script>
      (function () {
        const PV_ENDPOINT = 'https://app.track-flow.pro/page_view';

        // UID de visitante (1 ano)
        function ensureUid() {
          const k = 'tf_uid';
          const parts = ('; ' + document.cookie).split('; ' + k + '=');

          if (parts.length === 2) return parts.pop().split(';').shift();

          const v = (
            Math.random().toString(36).slice(2) + Date.now().toString(36)
          ).slice(0, 24);
          const exp = new Date(Date.now() + 365 * 864e5).toUTCString();

          document.cookie = k + '=' + v + '; path=/; expires=' + exp;
          return v;
        }

        function getCookie(name) {
          const parts = ('; ' + document.cookie).split('; ' + name + '=');
          return parts.length === 2
            ? parts.pop().split(';').shift()
            : undefined;
        }

        function sendPV() {
          const uid = ensureUid();
          const fbp = getCookie('_fbp');
          const qs = new URLSearchParams(location.search);
          const day = new Date().toISOString().slice(0, 10);

          const key = `tfpv::${location.hostname}::${location.pathname}::${day}`;

          // Se j√° enviou hoje nesta p√°gina, n√£o manda de novo
          if (localStorage.getItem(key)) {
            console.log('‚õî PageView j√° enviado hoje para esta p√°gina');
            return;
          }
          localStorage.setItem(key, '1');

          const payload = {
            tf_uid: uid,
            ts: Math.floor(Date.now() / 1000),
            day,
            url: location.href,
            ref: document.referrer || null,
            path: location.pathname || '/',
            fbclid: qs.get('fbclid') || null,
            utm_source: qs.get('utm_source') || null,
            utm_medium: qs.get('utm_medium') || null,
            utm_campaign: qs.get('utm_campaign') || null,
            utm_content: qs.get('utm_content') || null,
            utm_term: qs.get('utm_term') || null,
            fbp: fbp || null,
          };

          try {
            const blob = new Blob([JSON.stringify(payload)], {
              type: 'text/plain',
            });

            if (!navigator.sendBeacon || !navigator.sendBeacon(PV_ENDPOINT, blob)) {
              fetch(PV_ENDPOINT, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(payload),
              }).catch(() => {});
            }

            console.log('üì© PageView enviado (√∫nico por dia/p√°gina).');
          } catch (e) {
            try {
              fetch(PV_ENDPOINT, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(payload),
              }).catch(() => {});
            } catch (_) {}
          }
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', sendPV);
        } else {
          sendPV();
        }
      })();
    </script>
    <script type="module" src="./index.tsx"></script>
  </body>
</html>